<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generatore Scheda Utente</title>
  </head>
  <body>
    <input id="nome" placeholder="nome" />
    <br />
    <br />
    <input id="eta" type="number" placeholder="Et√†" />
    <br />
    <br />
    <input id="professione" placeholder="Professione" />
    <br />
    <br />

    <button id="btnAggiungi">Aggiungi utente</button>

    <div id="lista"></div>
    <script>
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      // PASSO 1: Array Globale
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      //Creo un array vuoto accessibile da tutte le funzioni per salvare gli utenti.
      let utenti = [];

      //Perch√®? Serve uno scope globale per mantenere i dati tra diverse chiamate di funzione.

      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      // PASSO 2: Funzione creaUtente() con Default Parameter
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

      //Creo una funzione per creare l'utente
      function creaUtente(nome, eta, professione = "non specificata") {
        console.log("Creazione nuovo utente...");

        let categoria;
        // Usa uno switch statement per classificare l'utente
        switch (
          professione.toLowerCase() //toLowerCase() rende la classificazione case-insensitive
        ) {
          case "studente":
            categoria = "studente";
            break;
          case "developer":
          case "programmatore":
          case "sviluppatore":
            categoria = "developer";
            break;
          case "designer":
          case "grafico":
            categoria = "designer";
            break;
          default:
            categoria = "altro";
        }

        return {
          //Restituisce un oggetto(come valore di ritorno) con tutte le propriet√†
          nome: nome,
          eta: eta,
          professione: professione,
          categoria: categoria,
        };
      }

      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      // PASSO 3: Arrow Function generaMessaggio()
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      const generaMessaggio = (utente) => {
        return `${utente.nome} ha ${utente.eta} anni ed √® classificato come ${utente.categoria}`;
      };

      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      // PASSO 4: Funzione mostraUtenti()
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      function mostraUtenti() {
        console.log("Aggiornamento lista utenti..."); // Logga un messaggio in console per indicare che la lista verr√† aggiornata

        const lista = document.getElementById("lista");
        lista.innerHTML = ""; // Pulisce completamente il contenuto dell'elemento lista

        // Se l'array 'utenti' √® vuoto...
        if (!utenti.length) {
          //Truthy / False
          // ...mostra un messaggio di stato "vuoto"
          lista.innerHTML =
            '<div class="empty-state">Nessun utente presente...</div>';
          return;
        }
        for (const utente of utenti) {
          const messaggio = generaMessaggio(utente);

          // Crea un blocco HTML che rappresenta un utente
          const userHTML = `
                              <div class="user-card">
                                  <h3>${utente.nome}</h3>
                                  <p>Et√†: ${utente.eta} anni</p>
                                  <p>Professione: ${utente.professione}</p>
                                  <p>Messaggio: ${messaggio}</p>

                                  <!-- Aggiunge una categoria con classe dinamica e testo in maiuscolo -->

                                  <span class="categoria ${utente.categoria}">
                                      ${utente.categoria.toUpperCase()}
                                  </span>
                              </div>
                               `;

          // Aggiunge l‚ÄôHTML generato alla lista gi√† presente
          lista.innerHTML += userHTML;
        }
      }

      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      // PASSO 5: Funzione debugUtenti()
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      function debugUtenti() {
        // Stampa un messaggio iniziale per indicare l'avvio del debug
        console.log("üêõ DEBUG: Inizio analisi utenti...");

        // Mostra la variabile 'utenti' in formato tabellare nella console
        console.table(utenti);

        // Ciclo che scorre tutti gli elementi dell'array 'utenti'
        for (const index in utenti) {
          // Stampa l‚Äôintestazione per ogni utente, indicando il numero progressivo
          console.log(`--- Utente #${parseInt(index) + 1} ---`);

          // Recupera l‚Äôoggetto utente alla posizione corrente dell‚Äôarray
          const utente = utenti[index];

          // Ciclo interno che scorre tutte le propriet√† dell‚Äôoggetto utente
          for (const proprieta in utente) {
            // Stampa ogni propriet√† e il relativo valore
            console.log(`${proprieta}: ${utente[proprieta]}`);
          }
        }

        // Messaggio finale che indica la fine del debug
        console.log("‚úÖ DEBUG completato!");
      }

      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      // PASSO 6: Funzione aggiungiUtente() - VALIDAZIONE
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

      function aggiungiUtenti() {
        //Selezione per ottenere i valori degli input
        const inputNome = document.getElementById("nome"); //salva in una variabile inputNome l'elemento htmml con l'id nome
        const inputEta = document.getElementById("eta");
        const inputProfessione = document.getElementById("professione");

        //Estraggo e pulisco i valori inseriti dall‚Äôutente
        const nome = inputNome.value.trim(); // Rimuove spazi prima/dopo
        const eta = parseInt(inputEta.value); // Converte la stringa in numero
        const professione = inputProfessione.value.trim();

        //Perch√© serve? Quando leggi un valore da un input HTML (input.value), il risultato √® sempre una stringa, anche se l‚Äôutente ha scritto un numero.

        // VALIDAZIONE

        // Controllo che il nome non sia vuoto
        if (!nome) {
          console.error("‚ùå ERRORE: Nome mancante!");
          alert("Per favore, inserisci il nome!");
          return;
        }

        // Controllo che l‚Äôet√† sia valida (et√† presente che sia un numero > 0)
        if (!eta || eta <= 0 || isNaN(eta)) {
          console.warn("‚ö†Ô∏è ATTENZIONE: Et√† non valida");
          alert("Per favore, inserisci un'et√† valida!");
          return;
        }

        console.log("‚úÖ Validazione superata!");

        // SCOPE - variabile locale
        let messaggio = "Utente aggiunto!";
        console.log(`üì¢ ${messaggio}`);

        //creazione nuovo utente

        // Crea un nuovo oggetto utente usando una funzione esterna
        const nuovoUtente = creaUtente(nome, eta, professione);
        // Aggiunge(salva) l‚Äôutente all‚Äôarray globale "utenti"
        utenti.push(nuovoUtente);

        console.log("‚úÖ Utente aggiunto con successo:", nuovoUtente);

        // Aggiorna visualizzazione
        mostraUtenti(); // aggiorna la lista visibile
        debugUtenti(); // mostra info di debug in console

        // Pulisci i campi
        inputNome.value = "";
        inputEta.value = "";
        inputProfessione.value = "";

        // Creo un alert con un template literal con backtick `...`
        alert(`${messaggio}\n${generaMessaggio(nuovoUtente)}`);
        // Il testo tra backtick permette di inserire variabili ed espressioni usando ${ ... }.
        // ${messaggio} Inserisce il valore della variabile messaggio.
        // \n  Va a capo (newline), quindi il messaggio verr√† spezzato su due linee.
        // ${generaMessaggio(nuovoUtente)} Esegue la funzione generaMessaggio passando nuovoUtente come argomento, e inserisce il risultato nel testo.
      }
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      // PASSO 7: Arrow Function filtraMaggiorenni() - EXTRA
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

      // Funzione che filtra gli utenti maggiorenni (et√† >= 18)
      const filtraMaggiorenni = () => {
        // Messaggio in console per indicare che il filtro √® stato attivato
        console.log("üîç Filtro maggiorenni attivato...");

        // Crea un nuovo array contenente solo gli utenti con et√† >= 18
        // .filter() scorre ogni elemento dell'array "utenti"
        const maggiorenni = utenti.filter((utente) => utente.eta >= 18);

        // Se non √® stato trovato nessun maggiorenne...
        if (maggiorenni.length === 0) {
          console.warn("‚ö†Ô∏è Nessun maggiorenne trovato!"); // Avviso in console
          alert("Non ci sono utenti maggiorenni nella lista."); // Messaggio popup
          return; // Esce dalla funzione
        }

        // Se ci sono maggiorenni, mostra quanti sono
        console.log(`‚úÖ Trovati ${maggiorenni.length} maggiorenni`);

        // Mostra i dati dei maggiorenni in tabella nella console
        console.table(maggiorenni);

        // Chiama una funzione esterna (presumibilmente per mostrare i risultati nella UI)
        mostraFiltro(maggiorenni);
      };

      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      // PASSO 8: Event Listeners
      // -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

      //da finire
    </script>
  </body>
</html>
